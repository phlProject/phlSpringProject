<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="a0000006/board">
	
	<!-- 책소개 > 조회 > Count -->
	<select id="bookListCnt" parameterType="hashmap" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM BSNS_MNG_BOARD		BMB
		     LEFT OUTER JOIN BSNS_MNG_BOARD_FL	BMBF
		      ON BMB.BSNS_CODE = BMBF.BSNS_CODE
		     AND BMB.BOARD_SN  = BMBF.BOARD_SN
		     AND BMBF.USE_YN = 'Y'
		WHERE 1=1
		  AND BMB.USE_YN = 'Y'
		  AND BMB.BSNS_CODE = #{BSNS_CODE}
		  AND BMB.BOARD_GBN_CD = #{BOARD_GBN_CD}
		  <if test="searchSelect != '' or searchSelect != null">
		  	<choose>
			 	<when test='searchSelect == "searchSubject"'>
			 		AND BMB.SUBJECT LIKE CONCAT('%',#{searchWord},'%')
			 	</when>
			 	<when test='searchSelect == "searchContent"'>
			 		AND BMB.CONTENTS LIKE CONCAT('%',#{searchWord},'%')
			 	</when>
			 	<when test='searchSelect == "searchSubCon"'>
			 		AND CONCAT(BMB.SUBJECT,BMB.CONTENTS) LIKE CONCAT('%',#{searchWord},'%')
			 	</when>
		  	</choose>
		  </if>
	</select>
	
	<!-- 책소개 > 조회  -->
	<select id="bookList" parameterType="hashmap" resultType="hashmap">
		SELECT BMB.BSNS_CODE
			  ,BMB.BOARD_SN
			  ,BMB.BOARD_GBN_CD
			  ,BMB.SUBJECT
			  ,BMB.CONTENTS
			  ,BMB.HIT_COUNT
			  ,BMB.LIKE_COUNT
			  ,BMBF.BOARD_FL_SN
			  ,BMBF.ORIGIN_FL_NM
			  ,BMBF.FL_NM
			  ,BMBF.FL_PATH
		FROM BSNS_MNG_BOARD		BMB
		     LEFT OUTER JOIN BSNS_MNG_BOARD_FL	BMBF
		      ON BMB.BSNS_CODE = BMBF.BSNS_CODE
		     AND BMB.BOARD_SN  = BMBF.BOARD_SN
		     AND BMBF.USE_YN = 'Y'
		WHERE 1=1
		  AND BMB.USE_YN = 'Y'
		  AND BMB.BSNS_CODE = #{BSNS_CODE}
		  AND BMB.BOARD_GBN_CD = #{BOARD_GBN_CD}
		  <if test="searchSelect != '' or searchSelect != null">
		  	<choose>
			 	<when test='searchSelect == "searchSubject"'>
			 		AND BMB.SUBJECT LIKE CONCAT('%',#{searchWord},'%')
			 	</when>
			 	<when test='searchSelect == "searchContent"'>
			 		AND BMB.CONTENTS LIKE CONCAT('%',#{searchWord},'%')
			 	</when>
			 	<when test='searchSelect == "searchSubCon"'>
			 		AND CONCAT(BMB.SUBJECT,BMB.CONTENTS) LIKE CONCAT('%',#{searchWord},'%')
			 	</when>
		  	</choose>
		  </if>
		ORDER BY BMB.BOARD_SN DESC
		LIMIT #{limitFirst}, #{limitSecond}
	</select>

	<!-- 책소개 > 상세  -->
	<select id="bookView" parameterType="hashmap" resultType="hashmap">
	SELECT BMB.BSNS_CODE
			  ,BMB.BOARD_SN
			  ,BMB.BOARD_GBN_CD
			  ,BMB.SUBJECT
			  ,BMB.CONTENTS
			  ,BMB.HIT_COUNT
			  ,BMB.LIKE_COUNT
			  ,BMBF.BOARD_FL_SN
			  ,BMBF.ORIGIN_FL_NM
			  ,BMBF.FL_NM
			  ,BMBF.FL_PATH
		FROM BSNS_MNG_BOARD		BMB
		     LEFT OUTER JOIN BSNS_MNG_BOARD_FL	BMBF
		      ON BMB.BSNS_CODE = BMBF.BSNS_CODE
		     AND BMB.BOARD_SN  = BMBF.BOARD_SN
		     AND BMBF.USE_YN = 'Y'
		WHERE 1=1
		  AND BMB.USE_YN = 'Y'
		  AND BMB.BSNS_CODE = #{BSNS_CODE}
		  AND BMB.BOARD_SN = #{board_Sn}
	</select>	

	<!-- 책소개 > 등록 -->
	<insert id="insertBook" parameterType="hashmap">
		INSERT INTO BSNS_MNG_BOARD(
			 BSNS_CODE
			,BOARD_GBN_CD
			,SUBJECT
			,CONTENTS
			,REG_DT
			,REG_ID
		)VALUES(
			 #{BSNS_CODE}
			,#{board_gbn_cd}
			,#{subject}
			,#{editor}
			,now()
			,'aa'
			<!-- ,#{SESSION_ID} -->
		)
	</insert>
	
	<!-- 책소개 > 수정 -->
	<update id="updateBook"  parameterType="hashmap">
		UPDATE BSNS_MNG_BOARD
		   SET SUBJECT = #{subject}
		      ,CONTENTS = #{editor}
		      ,MOD_DT = now()
		      ,MOD_ID = 'aa'
		 WHERE 1=1
		   AND BSNS_CODE = #{bsns_code}
		   AND BOARD_SN  = #{board_Sn}
	</update>
	
	<!-- 책소개 > 삭제 -->
	<update id="deleteBook"  parameterType="hashmap">
		UPDATE BSNS_MNG_BOARD
		   SET USE_YN = 'N'
		      ,MOD_DT = now()
		      ,MOD_ID = 'aa'
		 WHERE 1=1
		   AND BSNS_CODE = #{BSNS_CODE}
		   AND BOARD_SN  = #{board_Sn}
	</update>
	
	<!-- 게시판 > 파일 등록  -->
	<insert id="insertBoardFl"  parameterType="hashmap">
		INSERT INTO BSNS_MNG_BOARD_FL(
			 BSNS_CODE
			,BOARD_SN
			,ORIGIN_FL_NM
			,FL_NM
			,FL_PATH
			,REG_DT
			,REG_ID
		)VALUES(
			 #{BSNS_CODE}
			,#{board_Sn}
			,#{origin_fl_nm}
			,#{fl_nm}
			,#{fl_path}
			,now()
			,'aa'
			<!-- ,#{SESSION_ID} -->
		)
	</insert>
	
	<!-- 게시판 > 파일 수정  -->
	<update id="updateBoardFl"  parameterType="hashmap">
		UPDATE BSNS_MNG_BOARD_FL
		   SET ORIGIN_FL_NM = #{origin_fl_nm}
		      ,FL_NM = #{fl_nm}
		      ,FL_PATH = #{fl_path}
		      ,MOD_DT = now()
		      ,MOD_ID = 'aa'
		 WHERE 1=1 
		   AND BSNS_CODE = #{bsns_code}
		   AND BOARD_SN  = #{board_Sn}
		   AND BOARD_FL_SN =#{board_Fl_Sn}
	</update>
	
	<!-- 게시판 > 번호 채번  -->
	<select id="seqSn" resultType="java.lang.Integer">
		SELECT LAST_INSERT_ID()
	</select>
	
</mapper>