<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="phl/common">
	
	<!-- 공통코드 -->
    <select id="selectCommCode" parameterType="hashmap" resultType="hashmap">
    	SELECT CMMN_CODE
    	 	  ,CL_CODE
    	 	  ,DETAIL_CODE
    	 	  ,DETAIL_CODE_NM
    	  FROM PKHL_SYS_CMMN_CODE
    	 WHERE 1=1
    	   AND USE_YN = 'Y'
   		   AND BSNS_CODE = #{bsnsCode}
   		   <if test="clCode != null" >
   		   	AND CL_CODE = #{clCode}
   		   </if>
   		   <if test="notDetailCode != null" >
   		   	AND DETAIL_CODE NOT IN (${notDetailCode})
   		   </if>
    </select>
    
    <!--  -->
    <select id="selectCommCodeOne" parameterType="hashmap" resultType="java.lang.String">
    	SELECT DETAIL_CODE_NM
    	FROM PKHL_SYS_CMMN_CODE
    	 WHERE 1=1
    	   AND USE_YN = 'Y'
   		   AND BSNS_CODE = #{bsnsCode}
   		   AND CMMN_CODE = #{cmmnCode}
    </select>
    
    <!--  메뉴조회 (2dept)  -->
    <select id="menuListDept2" parameterType="hashmap" resultType="hashmap">
    
    	SELECT 1 AS MENU_LEVEL
    		  ,T1.MENU_CD	
    		  ,T1.UPPER_MENU_CD
    		  ,T1.MENU_NM
    		  ,T1.MENU_TY_CD
    		  ,T1.ORDR
    		  ,T1.MENU_LINK
    	FROM PKHL_SYS_MENU T1
    	WHERE 1=1
    	  AND NOT EXISTS (SELECT 1 FROM PKHL_SYS_MENU WHERE MENU_CD = T1.UPPER_MENU_CD)
    	  AND T1.USE_YN = 'Y'
    	  AND T1.BSNS_CODE = #{bsnsCode}
    	  
	   	UNION ALL
	   	
	    SELECT 2 AS MENU_LEVEL
			  ,T2.MENU_CD
	   	      ,T2.UPPER_MENU_CD
	   	      ,T2.MENU_NM
	   	      ,T2.MENU_TY_CD
	   	      ,T1.ORDR
	   	      ,T2.MENU_LINK
	   	  FROM PKHL_SYS_MENU T1
	   	      ,PKHL_SYS_MENU T2
	   	  WHERE 1=1
	   	    AND NOT EXISTS (SELECT 1 FROM PKHL_SYS_MENU WHERE MENU_CD = T1.UPPER_MENU_CD)
	   	    AND T1.MENU_CD = T2.UPPER_MENU_CD 
	   	    AND T1.BSNS_CODE = T2.BSNS_CODE
		    	 AND T1.BSNS_CODE = #{bsnsCode}
				 AND T1.USE_YN = 'Y'
				 AND T2.USE_YN = 'Y'
	   ORDER BY ORDR ASC, MENU_CD
    </select>
    
    <!--  메뉴조회 (3dept)  -->
    <select id="menuListDept3" parameterType="hashmap" resultType="hashmap">
    
    	SELECT 1 AS MENU_LEVEL
    		  ,T1.MENU_CD	
    		  ,T1.UPPER_MENU_CD
    		  ,T1.MENU_NM
    		  ,T1.MENU_TY_CD
    		  ,T1.ORDR
    		  ,T1.MENU_LINK
    	FROM PKHL_SYS_MENU T1
    	WHERE 1=1
    	  AND NOT EXISTS (SELECT 1 FROM PKHL_SYS_MENU WHERE MENU_CD = T1.UPPER_MENU_CD)
    	  AND T1.USE_YN = 'Y'
    	  AND T1.BSNS_CODE = #{bsnsCode}
    	  
	   	UNION ALL
	   	
	    SELECT 2 AS MENU_LEVEL
			  ,T2.MENU_CD
	   	      ,T2.UPPER_MENU_CD
	   	      ,T2.MENU_NM
	   	      ,T2.MENU_TY_CD
	   	      ,T1.ORDR
	   	      ,T2.MENU_LINK
	   	  FROM PKHL_SYS_MENU T1
	   	      ,PKHL_SYS_MENU T2
	   	  WHERE 1=1
	   	    AND NOT EXISTS (SELECT 1 FROM PKHL_SYS_MENU WHERE MENU_CD = T1.UPPER_MENU_CD)
	   	    AND T1.MENU_CD = T2.UPPER_MENU_CD 
	   	    AND T1.BSNS_CODE = T2.BSNS_CODE
    	 	AND T1.BSNS_CODE = #{bsnsCode}
		 	AND T1.USE_YN = 'Y'
		  	AND T2.USE_YN = 'Y'
				 
		UNION ALL
	   	
	    SELECT 3 AS MENU_LEVEL
			  ,T3.MENU_CD
	   	      ,T3.UPPER_MENU_CD
	   	      ,T3.MENU_NM
	   	      ,T3.MENU_TY_CD
	   	      ,T1.ORDR
	   	      ,T3.MENU_LINK
	   	  FROM PKHL_SYS_MENU T1
	   	      ,PKHL_SYS_MENU T2
	   	      ,PKHL_SYS_MENU T3
	   	  WHERE 1=1
	   	    AND NOT EXISTS (SELECT 1 FROM PKHL_SYS_MENU WHERE MENU_CD = T1.UPPER_MENU_CD)
	   	    AND T1.MENU_CD 	 = T2.UPPER_MENU_CD 
	   	    AND T1.BSNS_CODE = T2.BSNS_CODE
	   	    AND T2.MENU_CD 	 = T3.UPPER_MENU_CD 
	   	    AND T2.BSNS_CODE = T3.BSNS_CODE
	    	AND T1.BSNS_CODE = #{bsnsCode}
			AND T1.USE_YN = 'Y'
			AND T2.USE_YN = 'Y'
			AND T3.USE_YN = 'Y'
	   ORDER BY ORDR ASC, MENU_CD
    </select>
    
    <!-- 게시판 이전 다음 페이지 번호 -->
    <select id="selectBoardSn" parameterType="hashmap" resultType="java.lang.String">
    	SELECT BOARD_SN
    	FROM BSNS_BOARD
    	WHERE 1=1
    	  AND USE_YN = 'Y'
    	  AND BSNS_CODE 	= #{bsnsCode}
    	  AND BOARD_GBN_CD LIKE CONCAT('%',#{boardGbnCd},'%')
    	  
    	  <if test='move == "pre"'>
	    	  <![CDATA[
	    	  AND BOARD_SN < #{boardSn}
	    	  ORDER BY BOARD_SN DESC
	    	  ]]>
    	  </if>
    	  <if test='move == "after"'>
	    	  <![CDATA[
	    	  AND BOARD_SN > #{boardSn}
	    	  ORDER BY BOARD_SN ASC
	    	  ]]>
    	  </if>
    	  LIMIT 1
    </select>
    
    <!-- 게시판 조회수 증가  -->
    <update id="boardHitCount" parameterType="hashmap">
    	UPDATE BSNS_BOARD
		   SET HIT_COUNT = HIT_COUNT + 1
		 WHERE 1=1
		   AND BSNS_CODE = #{bsnsCode}
		   <if test='moveBoardSn == null'>
		   AND BOARD_SN  = #{boardSn}
		   </if>
		   <if test='moveBoardSn != null'>
		   AND BOARD_SN  = #{moveBoardSn}
		   </if>
    </update>
    
</mapper>